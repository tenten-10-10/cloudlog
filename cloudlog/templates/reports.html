{% extends "base.html" %}
{% block content %}
<section class="panel">
  <h1>レポート</h1>
  <form method="get" action="/reports" class="inline-form wrap">
    <label>開始日
      <input type="date" name="from_date" value="{{ from_date }}" />
    </label>
    <label>終了日
      <input type="date" name="to_date" value="{{ to_date }}" />
    </label>
    <button class="btn" type="submit">更新</button>
    <a class="btn btn--ghost" href="/export/entries.csv?from_date={{ from_date }}&to_date={{ to_date }}">CSV出力</a>
  </form>
</section>

<section class="panel">
  <h2>案件別損益</h2>
  <table>
    <thead>
      <tr>
        <th>案件</th>
        <th>実績工数(h)</th>
        <th>予算工数(h)</th>
        <th>実績原価(円)</th>
        <th>実績売上(円)</th>
        <th>損益(円)</th>
      </tr>
    </thead>
    <tbody>
      {% for p in project_rows %}
      <tr>
        <td>{{ p.project_code }} - {{ p.project_name }}</td>
        <td>{{ fmt_hours(p.actual_hours) }}</td>
        <td>{{ fmt_hours(p.budget_hours) }}</td>
        <td>{{ '%.0f' % p.actual_cost }}</td>
        <td>{{ '%.0f' % p.actual_revenue }}</td>
        <td class="{% if p.profit < 0 %}loss{% else %}gain{% endif %}">{{ '%.0f' % p.profit }}</td>
      </tr>
      {% else %}
      <tr><td colspan="6">データがありません</td></tr>
      {% endfor %}
    </tbody>
  </table>
</section>

{% if is_manager %}
<section class="panel">
  <h2>ユーザー別集計</h2>
  <table>
    <thead>
      <tr>
        <th>ユーザー</th>
        <th>ロール</th>
        <th>総工数</th>
        <th>承認済み</th>
        <th>申請中</th>
        <th>下書き</th>
        <th>差し戻し</th>
      </tr>
    </thead>
    <tbody>
      {% for u in user_rows %}
      <tr>
        <td>{{ u.username }}</td>
        <td>{{ u.role }}</td>
        <td>{{ fmt_hours(u.total_hours) }}</td>
        <td>{{ fmt_hours(u.approved_hours) }}</td>
        <td>{{ fmt_hours(u.submitted_hours) }}</td>
        <td>{{ fmt_hours(u.draft_hours) }}</td>
        <td>{{ fmt_hours(u.rejected_hours) }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</section>
{% endif %}
{% endblock %}
